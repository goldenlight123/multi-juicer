# Example Setup with digital ocean

## Prerequisites

This example expects you to have the following cli tools setup.

1. [doctl](https://github.com/digitalocean/doctl)
2. [helm](https://helm.sh)
3. [kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-on-macos)

## Step 1. Starting the cluster

```bash
#First we'll need a cluser, you can create one using the DigitalOcean cli.
# This will take a couple of minutes
doctl kubernetes cluster create juicy-k8s

# After completion verify that your kubectl context has been updated:
# Should print something like: do-nyc1-juicy-k8s
kubectl config current-context
```

## Step 2. Installing JuicyCTF via helm

```bash
# We'll need to clone this git repo for the moment, as the helm chart isnt pushed to any registry
git clone git@github.com:J12934/juicy-ctf.git
cd juicy-ctf/helm/juicy-ctf

# First we'll need to fetch the charts JuicyCTF depends on
helm dependency update ./

# Now we can install the helm chart
helm install juicy-ctf ./

# kubernetes will now spin up the pods
# to verify every thing is starting up, run:
kubectl get pods
# This should show you three pods a juice-balancer pod and two redis pods
# Wait untill all 3 pods are ready
```

## Step 3. Verify the app is running correctly

This step is optional, but helpful to catch errors quicker.

```bash
# lets test out if the app is working correctly before proceeding
# for that we can port forward the JuiceBalancer service to your local machine
kubectl port-forward service/juice-balancer 3000:3000

# Open up your browser for localhost:3000
# You should be able to see the JuicyCTF Balancer UI

# Try to create a team and see if everything works correctly
# You should be able to access a JuiceShop instances after a few seconds after creating a team,
# and after clicking the "Start Hacking" Button

# You can also try out if the admin UI works correctly
# Go back to localhost:3000/balancer
# To log in as the admin log in as the team "admin"
# The password for the team gets autogenerated if not specified, you can extract it from the kubernetes secret:
kubectl get secrets juice-balancer-secret -o=jsonpath='{.data.adminPassword}' | base64 --decode
```

## Step 4. Add a LoadBalancer to expose the app to the world

TODO
